---
import Container from '../components/Container.astro';
---

<Container>
<div class="solar-system-container">
    <canvas id="solar-system-canvas"></canvas>
</div>

</Container>

<script>
import { Body, HelioVector, HelioDistance } from "astronomy-engine";

// This function contains your drawing logic
const drawSolarSystem = () => {
    const date = new Date();
    const canvas = document.getElementById('solar-system-canvas') as HTMLCanvasElement;
    const container = canvas?.parentElement;
    const dpr = window.devicePixelRatio || 1;
    if (!canvas || !container) return;

    // Update internal canvas resolution to match its CSS/Container size
    canvas.width = container.clientWidth*window.devicePixelRatio;
    canvas.height = canvas.width * 9 / 16; // Maintain 16:9 aspect ratio
    
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const ctx = canvas.getContext('2d');
    const unit = Math.min(canvas.width, canvas.height) / 100 as number;


    const planets = [
        {body: Body.Mercury, color: 'gray',      size: 1.0},
        {body: Body.Venus,   color: 'orange',    size: 1.5},
        {body: Body.Earth,   color: 'Blue',      size: 1.6},
        {body: Body.Mars,    color: 'red',       size: 1.2},
        {body: Body.Jupiter, color: 'brown',     size: 3.0},
        {body: Body.Saturn,  color: 'goldenrod', size: 2.6},
        {body: Body.Uranus,  color: 'lightblue', size: 2.0},
        {body: Body.Neptune, color: 'darkblue',  size: 2.0},
    ];

    ctx?.clearRect(0,0,canvas.width, canvas.height);
    ctx!.fillStyle = 'black';
    ctx!.fillRect(0, 0, canvas.width, canvas.height);
    
    // Draw Sun
    ctx!.beginPath();
    ctx!.arc(centerX, centerY, 5*unit, 0, 2 * Math.PI);
    ctx!.fillStyle = 'yellow';
    ctx!.fill();
    
    const mercury_distnace = HelioDistance(Body.Mercury, date);
    planets.forEach(element => {
        const helioVector = HelioVector(element.body, date);
        const relativeDist = 11* Math.log(1+HelioDistance(element.body, date)/0.4)*unit;
        const relativeSize = element.size*unit;
        const angle = Math.atan2(helioVector.y, helioVector.x);
        //angle = -Math.PI/2;
        ctx!.beginPath();
        ctx!.arc(
            centerX + relativeDist * Math.cos(angle), 
            centerY + relativeDist * Math.sin(angle), 
            relativeSize, 0, 2 * Math.PI
        );
        ctx!.fillStyle = element.color;
        ctx!.fill();
    });
    ctx!.fillStyle = "white";
    ctx!.font = `${12 * dpr}px sans-serif`;
    ctx?.fillText(`Solar system representation at ${date}`, 10, canvas.height - 10);
    
};

// Re-run the code on every view transition
document.addEventListener('astro:page-load', drawSolarSystem);
window.addEventListener('resize', drawSolarSystem);
</script>


<style>
    .solar-system-container {
        width: 100%; /* Fill the Container.astro width */
        aspect-ratio: 16 / 9; /* Maintain a consistent shape */
        display: flex;
    }
    #solar-system-canvas {
        width: 100%;
        height: 100%;
    }
</style>